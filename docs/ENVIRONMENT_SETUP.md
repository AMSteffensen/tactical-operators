# üîë Environment Variables Setup Guide

This guide helps you set up all the environment variables needed for your tactical-operator project across all environments.

---

## üìã Quick Setup Checklist

- [ ] **Development Environment** - Local .env files
- [ ] **Railway Environment** - Production API variables  
- [ ] **Vercel Environment** - Production frontend variables
- [ ] **GitHub Secrets** - CI/CD automation variables
- [ ] **Expo Environment** - Mobile app variables (optional)

---

## üè† Development Environment

### 1. **API Server (.env)**

Copy and configure the API server environment:

```bash
cd api-server
cp .env.example .env
```

**Edit `api-server/.env`:**
```bash
# Database (choose one option)

# Option A: Docker Database (Recommended)
DATABASE_URL="postgresql://tactical_user:tactical_dev_password@localhost:5432/tactical_operator"

# Option B: Local PostgreSQL
# DATABASE_URL="postgresql://yourusername:yourpassword@localhost:5432/tactical_operator"

# Server Configuration
PORT=3001
NODE_ENV=development

# Authentication (generate secure secret for production)
JWT_SECRET=dev_secret_do_not_use_in_production_1234567890abcdef
JWT_EXPIRES_IN=7d

# CORS (allows web client to connect)
CORS_ORIGIN=http://localhost:3000
SOCKET_CORS_ORIGIN=http://localhost:3000

# Rate Limiting
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=100
```

### 2. **Web Client (.env)**

Copy and configure the web client environment:

```bash
cd web-client
cp .env.example .env
```

**Edit `web-client/.env`:**
```bash
# API Connection
VITE_API_URL=http://localhost:3001/api
VITE_SOCKET_URL=http://localhost:3001
```

---

## üåê Production Environment Variables

### 3. **Railway (API + Database)**

In your Railway dashboard, set these environment variables:

```bash
# Database (Railway auto-provides this)
# DATABASE_URL=postgresql://... (Auto-generated by Railway)

# Server
NODE_ENV=production
PORT=3001

# Authentication (IMPORTANT: Generate secure 64-character secret)
JWT_SECRET=REPLACE_WITH_SECURE_64_CHAR_HEX_STRING_abc123def456ghi789
JWT_EXPIRES_IN=7d

# CORS (IMPORTANT: Replace with your actual Vercel URL)
CORS_ORIGIN=https://your-app-name.vercel.app
SOCKET_CORS_ORIGIN=https://your-app-name.vercel.app

# Rate Limiting
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=100
```

### 4. **Vercel (Web Client)**

In your Vercel dashboard, set these environment variables:

```bash
# API Connection (IMPORTANT: Replace with your actual Railway URL)
VITE_API_URL=https://your-railway-api.up.railway.app/api
VITE_SOCKET_URL=https://your-railway-api.up.railway.app
```

---

## üîÑ GitHub Secrets (CI/CD)

In your GitHub repository (Settings ‚Üí Secrets and variables ‚Üí Actions), add:

### Railway Deployment
```bash
RAILWAY_TOKEN=your_railway_deployment_token
```

### Vercel Deployment
```bash
VERCEL_TOKEN=your_vercel_deployment_token
VERCEL_ORG_ID=your_vercel_organization_id
VERCEL_PROJECT_ID=your_vercel_project_id
```

### Production URLs (for build-time injection)
```bash
VITE_API_URL=https://your-railway-api.up.railway.app/api
VITE_SOCKET_URL=https://your-railway-api.up.railway.app
```

### Expo (Mobile App) - Optional
```bash
EXPO_TOKEN=your_expo_deployment_token
```

---

## üîê How to Generate Secure Values

### JWT Secret (Production)
```bash
# Generate a secure 64-character hex string
node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"

# Example output:
# a1b2c3d4e5f6789012345678901234567890abcdef1234567890abcdef123456
```

### Strong Database Password
```bash
# Generate a secure database password
node -e "console.log(require('crypto').randomBytes(16).toString('base64'))"

# Example output:
# x7K9mP2vN8qR5wT1
```

---

## üöÄ Step-by-Step Setup

### Development Setup (5 minutes)

1. **Set up API environment**:
   ```bash
   cd api-server
   cp .env.example .env
   # Edit .env with your database settings
   ```

2. **Set up web client environment**:
   ```bash
   cd web-client
   cp .env.example .env
   # Usually no changes needed for development
   ```

3. **Start development**:
   ```bash
   npm run dev
   ```

### Production Setup (15 minutes)

1. **Railway setup**:
   - Create project on Railway
   - Add PostgreSQL database (auto-generates DATABASE_URL)
   - Set environment variables listed above
   - Generate and copy Railway token

2. **Vercel setup**:
   - Import project on Vercel
   - Set environment variables with your Railway URL
   - Generate and copy Vercel token + IDs

3. **GitHub secrets**:
   - Add all tokens and URLs to GitHub repository secrets

4. **Deploy**:
   ```bash
   npm run deploy
   ```

---

## üîç Environment Variable Reference

| Variable | Used By | Purpose | Example |
|----------|---------|---------|---------|
| `DATABASE_URL` | API Server | PostgreSQL connection | `postgresql://user:pass@host:port/db` |
| `JWT_SECRET` | API Server | Authentication tokens | `a1b2c3d4e5f6...` (64 chars) |
| `PORT` | API Server | Server port | `3001` |
| `NODE_ENV` | API Server | Environment mode | `development` / `production` |
| `CORS_ORIGIN` | API Server | Web client URL | `http://localhost:3000` |
| `SOCKET_CORS_ORIGIN` | API Server | WebSocket CORS | `http://localhost:3000` |
| `VITE_API_URL` | Web Client | API endpoint | `http://localhost:3001/api` |
| `VITE_SOCKET_URL` | Web Client | WebSocket endpoint | `http://localhost:3001` |
| `RAILWAY_TOKEN` | GitHub Actions | Railway deployment | `secret-token` |
| `VERCEL_TOKEN` | GitHub Actions | Vercel deployment | `secret-token` |

---

## üõ†Ô∏è Quick Commands

```bash
# Copy development environment files
npm run setup:env

# Check environment variables are loaded
npm run test:env

# Generate secure JWT secret
npm run generate:jwt

# Validate environment setup
npm run validate:env
```

---

## ‚ö†Ô∏è Security Best Practices

### Development
- ‚úÖ Use weak secrets (already configured)
- ‚úÖ Use localhost URLs
- ‚úÖ Commit .env.development files (they're safe)

### Production
- ‚ùå **Never** commit .env files with real secrets
- ‚úÖ Use 64-character hex JWT secrets
- ‚úÖ Use HTTPS URLs only
- ‚úÖ Store secrets in hosting platform dashboards
- ‚úÖ Rotate secrets regularly

### GitHub Secrets
- ‚úÖ Store all production tokens as GitHub secrets
- ‚úÖ Use least-privilege access tokens
- ‚ùå Never log secret values in CI/CD

---

## üîß Troubleshooting

### API won't start
- Check DATABASE_URL format
- Verify PostgreSQL is running
- Confirm all required variables are set

### Web client can't connect to API
- Verify VITE_API_URL points to running API
- Check CORS_ORIGIN in API matches web client URL
- Confirm ports match (API: 3001, Web: 3000)

### Railway deployment fails
- Ensure all production variables are set
- Check Railway logs for specific errors
- Verify DATABASE_URL is auto-generated (don't override)

### Vercel deployment fails
- Confirm VITE_* variables are set in Vercel dashboard
- Check build logs for missing environment variables
- Verify API URL is accessible from Vercel

---

## üìã Environment Validation

Run this command to validate your environment setup:

```bash
# Check all environments are configured
npm run validate:env

# Test API connection
curl http://localhost:3001/health

# Test production API
curl https://your-railway-api.up.railway.app/health
```

---

*Last Updated: July 5, 2025*
*Keep this guide updated when adding new environment variables*
